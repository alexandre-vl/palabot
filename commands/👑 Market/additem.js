const { MessageEmbed } = require("discord.js-12");
const config = require("../../botconfig/config.json");
const ee = require("../../botconfig/embed.json");
const Discord = require("discord.js-12");
module.exports = {
  name: "additem",
  category: "üëë Market",
  aliases: ["addi"],
  cooldown: 7,
  usage: "additem <quantit√©> <prix> <item>",
  description: "Permet d'ajouter un item au market inter-serveurs",
  memberpermissions: [],
  requiredroles: [],
  alloweduserids: [],
  run: (client, message, prefix) => {
    const db = require("quick.db");
    var word_finder = require("close-word");

    let args = message.content.substring(prefix.length).split(" ");
    let args1 = message.content.split(" ").slice(3).join(" ");
    let items = db.get(`bot.items`);
    let itemsnbrs = db.get(message.author.id + ".itemsbnr");
    let newitems = Object.entries(items);

    let lastid = newitems.length;
    let author_id = message.author.id;

    if (!args[1])
      return message.channel.send(
        "Arguments invalide (" + prefix + "additem <quantit√©> <prix> <nom>)"
      );
    if (!isNumeric(args[1]))
      return message.channel.send(
        "Veuillez pr√©ciser un nombre valide pour la quantit√© !"
      );
    if (args[1] > 20000)
      return message.channel.send(
        "Veuillez pr√©ciser une quantit√© inf√©rieur √† 20 000"
      );
    if (args[1] < 1)
      return message.channel.send(
        "Veuillez pr√©ciser une quantit√© supp√©rieur √† 1"
      );
    if (!args[2])
      return message.channel.send(
        "Arguments invalide (" + prefix + "additem <quantit√©> <prix> <nom>)"
      );
    if (args[2].length > 7)
      return message.channel.send(
        "Veuillez pr√©ciser un prix d'item moins long"
      );
    if (!isNumeric(args[2]))
      return message.channel.send(
        "Veuillez pr√©ciser un nombre valide pour le prix !"
      );
    if (args[2] < 1)
      return message.channel.send(
        "Veuillez pr√©ciser un nombre plus grande que 1$ !"
      );
    if (!args1)
      return message.channel.send(
        "Arguments invalide (" + prefix + "additem <quantit√©> <prix> <nom>)"
      );
    if (itemsnbrs > 4)
      return message.channel.send(
        "Vous avez atteint le nombre d'item maximal dans le market !"
      );

    var result = word_finder.findClosestOne(args1, [
      "roche",
      "bloc d'herbe",
      "terre",
      "podzol",
      "pierres",
      "planches de ch√™ne",
      "planches de sapin",
      "planches de bouleau",
      "planches d'acajou",
      "planches d'acacia",
      "planches de ch√™ne noir",
      "pousse de ch√™ne",
      "pousse de sapin",
      "pousse de bouleau",
      "pousse d'acajou",
      "pousse d'acacia",
      "pousse de ch√™ne noir",
      "sable",
      "sable rouge",
      "gravier",
      "minerai d'or",
      "minerai de fer",
      "minerai de charbon",
      "bois de ch√™ne",
      "bois de sapin",
      "bois de bouleau",
      "bois d'acajou",
      "feuilles de ch√™ne",
      "feuilles de sapin",
      "feuilles de bouleau",
      "feuilles d'acajou",
      "√©ponge",
      "verre",
      "minerai de lapis-lazuli",
      "bloc de lapis-lazuli",
      "distributeur",
      "gr√®s",
      "gr√®s sculpt√©",
      "gr√®s poli",
      "bloc musical",
      "rails de propulsion",
      "rails d√©t√©cteurs",
      "piston collant",
      "toile d'araign√©e",
      "hautes herbes",
      "foug√®re",
      "arbustre mort",
      "piston",
      "laine blanche",
      "laine orange",
      "laine magenta",
      "laine bleu clair",
      "laine jaune",
      "laine vert clair",
      "laine rose",
      "laine grise",
      "laine gris clair",
      "laine cyan",
      "laine violette",
      "laine bleue",
      "laine marron",
      "laine verte",
      "laine rouge",
      "laine noire",
      "pissenlit",
      "coquelicot",
      "orchid√©e bleue",
      "allium",
      "houstonie",
      "tulipe rouge",
      "tulipe orange",
      "tulipe blanche",
      "tulipe rose",
      "marguerite",
      "champignon",
      "bloc d'or",
      "bloc de fer",
      "dalle en pierre",
      "dalle en gr√®s",
      "dalle en pierres",
      "dalle en brique",
      "dalle en pierre taill√©e",
      "dalle en briques du nether",
      "dalle en quartz",
      "briques",
      "tnt",
      "biblioth√®que",
      "pierres moussues",
      "obsidienne",
      "torche",
      "escaliers en bois",
      "coffre",
      "minerai de diamand",
      "bloc de diamand",
      "√©tabli",
      "terre labour√©e",
      "fourneau",
      "√©chelle",
      "rails",
      "escaliers en pierre",
      "levier",
      "plaque de pression",
      "minerai de redstone",
      "torche de redstone",
      "bouton",
      "neige",
      "glace",
      "cactus",
      "argile",
      "jukebox",
      "barri√®re",
      "citrouille",
      "roche du nether",
      "sable des √¢mes",
      "pierre lumineuse",
      "citrouille-lanterne",
      "verre blanc",
      "verre orange",
      "verre magenta",
      "verre bleu clair",
      "verre jaune ",
      "verre vert clair",
      "verre rose",
      "verre gris",
      "verre gris clair",
      "verre cyan",
      "verre violet",
      "verre bleu",
      "verre marron",
      "verre vert",
      "verre rouge",
      "verre noir",
      "trappe de bois",
      "barreaux de fer",
      "vitre",
      "past√®que",
      "lianes",
      "portillon",
      "escaliers en briques",
      "escaliers en pierre taill√©e",
      "myc√©lium",
      "n√©nuphar",
      "brique du nether",
      "barri√®re en briques du nether",
      "escaliers en briques du nether",
      "table d'enchantement",
      "lampe √† redstone",
      "dalle en bois de ch√™ne",
      "dalle en bois de sapin",
      "dalle en bois de bouleau",
      "dalle en bois d'acajou",
      "dalle en bois d'acacia",
      "dalle en bois de ch√™ne noir",
      "escaliers en gr√®s",
      "minerai d'√©meraude",
      "coffre du n√©ant",
      "crochet",
      "bloc d'√©meraude",
      "escaliers en bois de sapin",
      "escaliers en bois de bouleau",
      "escaliers en bois d'acajou",
      "balise",
      "muret",
      "bouton",
      "enclume",
      "coffre pi√©g√©",
      "plaque de pression pond√©r√©e",
      "capteur de lumi√®re du jour",
      "bloc de redstone",
      "minerai de quartz du nether",
      "entonnoir",
      "bloc de quartz",
      "escaliers en quartz",
      "rails d√©clencheurs",
      "dropper",
      "terre cuite blanche",
      "terre cuite orange",
      "terre cuite magenta",
      "terre cuite bleu clair",
      "terre cuite jaune",
      "terre cuite vert clair",
      "terre cuite rose",
      "terre cuite grise",
      "terre cuite gris clair",
      "terre cuite cyan",
      "terre cuite violette",
      "terre cuite bleue",
      "terre cuite marron",
      "terre cuite verte",
      "terre cuite rouge",
      "terre cuite noire",
      "vitre blanche",
      "vitre orange",
      "vitre magenta",
      "vitre bleu clair",
      "vitre jaune",
      "vitre vert clair",
      "vitre rose",
      "vitre grise",
      "vitre gris clair",
      "vitre cyan",
      "vitre violette",
      "vitre bleue",
      "vitre marron",
      "vitre verte",
      "vitre rouge",
      "vitre noire",
      "feuilles d'acacia",
      "feuilles de ch√™ne noir",
      "bois d'acacia",
      "bois de ch√™ne noir",
      "escaliers en bois d'acacia",
      "escaliers en bois de ch√™ne noir",
      "bloc de paille",
      "tapis blanc",
      "tapis orange",
      "tapis magenta",
      "tapis bleu clair",
      "tapis jaune",
      "tapis vert clair",
      "tapis rose",
      "tapis gris",
      "tapis gris clair",
      "tapis cyan",
      "tapis violet",
      "tapis bleu",
      "tapis marron",
      "tapis vert",
      "tapis rouge",
      "tapis noir",
      "terre cuite",
      "bloc de charbon",
      "glace compact√©e",
      "tournesol",
      "lilas",
      "tr√®s hautes herbes",
      "grande foug√®re",
      "rosier",
      "pivoine",
      "pelle en fer",
      "pioche en fer",
      "hache en fer",
      "briquet",
      "pomme",
      "arc",
      "fl√®che",
      "charbon",
      "charbon de bois",
      "diamant",
      "lingot de fer",
      "lingot d'or",
      "√©p√©e en fer",
      "√©p√©e en bois",
      "pelle en bois",
      "pioche en bois",
      "hache en bois",
      "√©p√©e en pierre",
      "pelle en pierre",
      "pioche en pierre",
      "hache en pierre",
      "√©p√©e en diamant",
      "pelle en diamant",
      "pioche en diamant",
      "hache en diamant",
      "b√¢ton",
      "bol",
      "soupe de champignons",
      "√©p√©e en or",
      "pelle en or",
      "pioche en or",
      "hache en or",
      "ficelle",
      "plume",
      "poudre √† canon",
      "houe en bois",
      "houe en pierre",
      "houe en fer",
      "houe en diamant",
      "houe en or",
      "graines de bl√©",
      "bl√©",
      "pain",
      "chapeau en cuir",
      "tunique en cuir",
      "pantalon en cuir",
      "bottes en cuir",
      "casque en mailles",
      "cotte en mailles",
      "jambi√®res en mailles",
      "bottes en mailles",
      "casque en fer",
      "plastron en fer",
      "jambi√®res en fer",
      "bottes en fer",
      "casque en diamant",
      "plastron en diamant",
      "jambi√®res en diamant",
      "bottes en diamant",
      "casque en or",
      "plastron en or",
      "jambi√®res en or",
      "bottes en or",
      "silex",
      "viande de porc crue",
      "viande de porc cuite",
      "pomme dor√©e",
      "pomme cheat",
      "pancarte",
      "porte en bois",
      "sceau",
      "sceau d'eau",
      "sceau de lave",
      "porte en fer",
      "redstone",
      "bateau",
      "cuir",
      "sceau de lait",
      "brique",
      "argile",
      "canne √† sucre",
      "papier",
      "livre",
      "boule de slime",
      "bousole",
      "canne √† p√™che",
      "poudre de pierre luisante",
      "poche d'encre",
      "rouge de rose",
      "vert de cactus",
      "f√®ves de cacao",
      "lapis-lazuli",
      "teinture violette",
      "teinture cyan",
      "teinture gris clair",
      "teinture grise",
      "teinture rose",
      "teinture magenta",
      "teinture orange",
      "poudre d'os",
      "os",
      "sucre",
      "g√¢teau",
      "lit",
      "carte",
      "cisailles",
      "past√®que",
      "graines de citrouille",
      "graines de past√®que",
      "boeuf cru",
      "steak",
      "poulet cru",
      "poulet r√¥ti",
      "chair putr√©fi√©e",
      "enderpearl",
      "b√¢ton de blaze",
      "larme de ghast",
      "p√©pite d'or",
      "verrue du nether",
      "oeil d'araign√©e",
      "oeil d'araign√©e ferment√©",
      "poudre de blaze",
      "cr√®me de magma",
      "alambic",
      "chaudron",
      "oeil du n√©ant",
      "√©meraude",
      "carotte",
      "pomme de terre",
      "pomme de terre cuite",
      "carte vierge",
      "carotte dor√©e",
      "cr√¢ne de squelette",
      "cr√¢ne de wither squelette",
      "t√™te de zombie",
      "t√™te",
      "t√™te de creeper",
      "√©toile du nether",
      "fus√©e de feu d'artifice",
      "√©toile de feu d'artifice",
      "brique du nether",
      "quartz du nether",
      "laisse",
      "√©tiquette",
      "coffre en fer",
      "coffre en or",
      "coffre en diamant",
      "coffre en cuivre",
      "coffre en argent",
      "coffre en ctristal",
      "coffre en obsidian",
      "Coffre en terre",
      "Am√©lioration coffre fer -> or",
      "Am√©lioration coffre or -> diamant",
      "Am√©lioration coffre cuivre -> argent",
      "Am√©lioration coffre argent -> or",
      "Am√©lioration coffre cuivre -> fer",
      "Am√©lioration coffre diamant -> crystal",
      "Am√©lioration coffre bois -> fer",
      "Am√©lioration coffre bois -> cuivre",
      "Am√©lioration coffre diamant -> obsidian",
      "Drawer 1x1",
      "Drawer 1x2",
      "Drawer 2x2",
      "Mod√®le d'am√©lioration",
      "Slimepad",
      "bloc de paladium",
      "bloc de titane",
      "bloc d'amethyst",
      "Four en paladium",
      "Spike en bois",
      "Spike en fer",
      "spiket en or",
      "spike en dimant",
      "spike en amethyst",
      "spike en titane",
      "spike en paladium",
      "rose",
      "Enclume",
      "Table d'enchantement",
      "balise",
      "glass",
      "Extractor",
      "Lucky block Paladium",
      "Lucky block endium",
      "Fleur de chasse",
      "ascenseur",
      "spawner vide",
      "spawner cass√©",
      "poudre de perlinpinpin",
      "bambou",
      "bloc de bambou",
      "enclume en paladium",
      "Enclume en titane",
      "enclume en amethyst",
      "table d'√©criture",
      "entonnoir en paladium",
      "bloc de trixium",
      "lingot d'amethyst",
      "lingot de titane",
      "lingot de paladium",
      "lingot d'endium",
      "fragment d'endium",
      "findium",
      "p√©pite d'endium",
      "pioche en amethyst",
      "pelle en amethyst",
      "hache en amethyst",
      "√©p√©e en amethyst",
      "casque en amethyst",
      "plastron en amethyst",
      "jambi√®res en amethyst",
      "bottes en amethyst",
      "pioche titane",
      "hache en titane",
      "pelle en titane",
      "√©p√©e en titane",
      "casque en titane",
      "plastron en titane",
      "jambi√®res en titane",
      "bottes en titane",
      "pioche en paladium",
      "hache en paladium",
      "pelle en paladium",
      "√©p√©e en paladium",
      "casque en paladium",
      "plastron en paladium",
      "jambi√®res en paladium",
      "bottes en paladium",
      "pomme en paladium",
      "pioche en endium",
      "hache en endium",
      "pelle en endium",
      "√©p√©e en endium",
      "casque en endium",
      "plastron en endium",
      "jambi√®res en endium",
      "bottes en endium",
      "chest explorer",
      "voidstone",
      "voidstone minage",
      "small ring",
      "medium ring",
      "big ring",
      "small endium ring",
      "medium endium ring",
      "big endium ring",
      "Heal Stick",
      "Speed stick",
      "Strength Stick",
      "jump stick",
      "stick of god",
      "damage stick",
      "hyper jump stick",
      "teleport stick",
      "unclaimfinder vert",
      "unclaimfinder orange",
      "unclaimfinder rouge",
      "unclaimfinder bleu",
      "paladium bow",
      "infernal knocker",
      "switch arrow",
      "orangeblue",
      "kiwano",
      "xp berry",
      "compressed xp berry",
      "orangeblue seeds",
      "kiwano seeds",
      "chervil seeds",
      "eggplants seeds",
      "furnace upgrade",
      "palamixed coal",
      "Empty bow modifier",
      "Bow range modifier",
      "bow speed modifier",
      "compressed paladium",
      "compressed titane",
      "compressed amethyst",
      "travel boots",
      "travel leggings",
      "hood helmer",
      "jump chestplate",
      "scuba helmet",
      "slimy helmet",
      "hang glider",
      "backpack",
      "magical tool",
      "endium gauntlet",
      "dynamite",
      "ninja dynamite",
      "big dynamite",
      "endium dynamite",
      "Sulfuric water",
      "Angelic water",
      "amethyst seedplanter",
      "titane seedplanter",
      "paladium seedplanter",
      "endium seedplanter",
      "stick paladium",
      "stick titane",
      "stick amethyst",
      "paladium core",
      "diamond string",
      "wing",
      "potion launcher",
      "legendarystone random",
      "legendarystone teleporation",
      "legendarystone invisibility",
      "legendarystone fortune",
      "legendarystone power",
      "legendarystone jobs",
      "legendarystone chaos",
      "extrapolated bucket",
      "axe patern",
      "hammer patern",
      "shovel patern",
      "broadsword patern",
      "fastsword patern",
      "pickaxe patern",
      "sword patern",
      "ingot patern",
      "block patern",
      "Socket patern",
      "fastsword head",
      "broadsword head",
      "pickaxe head",
      "sword head",
      "shovel head",
      "hammer head",
      "axe head",
      "smelt modifier",
      "fortune modifier",
      "speed modifier",
      "damage modifier",
      "flamme modifier",
      "knockback modifier",
      "autorepair modifier",
      "more upgrade modifier",
      "paladium hammer",
      "titane hammer",
      "amethyst hammer",
      "smith hammer",
      "paladium broadsword",
      "titane broadsword",
      "amethyst broadsword",
      "paladium fastsword",
      "titane fastsword",
      "amethyst fastsword",
      "colle",
      "moula stone",
      "Am√©lioration Cobblebreaker amethyst",
      "Am√©lioration Cobblebreaker titane",
      "Am√©lioration Cobblebreaker paladium",
      "aimant",
      "chorus fruit",
      "cooked mutton",
      "rabbit hide",
      "prismarine crystal",
      "prismarine shard",
      "beetroot",
      "beetroot seeds",
      "rabbit's foot",
      "raw mutton",
      "raw rabbit",
      "end crystal",
      "cooked rabbit",
      "obsdian",
      "connected dirt",
    ]);
    const add = new Discord.MessageEmbed()
      .setColor("EC5922")
      .setTitle("üîé | Recherche Market")
      .setDescription("Item trouv√© : `" + result.word + "`")
      .addField("Voulez-vous vraiment ajouter cette item ?", "‚úÖ ou ‚ùå")
      .setFooter(
        "¬© PalaBot 2021 ‚Ä¢ Created By Xvirus9",
        "https://cdn.discordapp.com/attachments/657878417324113983/873843137817239563/nT0fW4I-.jpg"
      );
    message.channel.send(add).then((m) => {
      m.react("‚úÖ");
      m.react("‚ùå");
      const collector = m.createReactionCollector(
        (reaction, user) =>
          ["‚úÖ", "‚ùå"].includes(reaction.emoji.name) && user.id === author_id,
        { time: 120000 }
      );

      collector.on("collect", (reaction) => {
        reaction.users.remove(author_id);
        if (reaction.emoji.name === "‚úÖ") {
          try {
            m.delete();
          } catch (e) {
            console.log(e);
          }
          items.unshift({
            name: result.word,
            price: args[2],
            nbr: args[1],
            id: lastid + 1,
            authorID: message.author.id,
          });

          db.set("bot.items", items);
          db.add(message.author.id + ".itemsbnr", 1);

          message.channel.send(
            "Vous venez d'ajouter `" +
              args[1] +
              "` " +
              result.word +
              " pour `" +
              args[2] +
              "$`"
          );
        } else {
          try {
            m.delete();
          } catch (e) {
            console.log(e);
          }
          message.channel.send("‚ùå Vente annul√©e...");
        }
      });
    });

    function isNumeric(str) {
      if (typeof str != "string") return false; // we only process strings!
      return (
        !isNaN(str) && !isNaN(parseFloat(str)) // use type coercion to parse the _entirety_ of the string (`parseFloat` alone does not do this)...
      ); // ...and ensure strings of whitespace fail
    }
  },
};
